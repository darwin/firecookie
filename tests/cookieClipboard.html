<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
          "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<script src="env.js" type="text/javascript"></script>
<script src="utils.js" type="text/javascript"></script>
<script>
enablePrivilege("UniversalXPConnect");

var requestUri = getCurrentPath() + "cookieClipboard.txt";
fireunit.registerPathHandler(requestUri, function (metadata, response) 
{
    enablePrivilege("UniversalXPConnect");
    response.setHeader("Set-Cookie", 
        "TestCookie=TestValue; " +
        "expires=Sat, 01-Jan-2100 00:00:00 GMT; " +
        "path=/dir; " +
        "HttpOnly", 
        false);
});

setTimeout(function() 
{
    enablePrivilege("UniversalXPConnect");
    FBTrace.sysout("fireunit.cookieClipboard.testClipboard.");

    Firebug.showBar(true);
    FirebugChrome.selectPanel("cookies");
    var panelNode = fireunit.panel("cookies");

    makeRequest("GET", requestUri, function(request) 
    {
        enablePrivilege("UniversalXPConnect");

        // Helper shortcuts
        var CookieRow = Firebug.FireCookieModel.Templates.CookieRow;
        var CookieClipboard = Firebug.FireCookieModel.CookieClipboard

        // Copy cookie into the clipboard, get from clipboard again and check.
        var cookieRow = FBL.getElementsByClass(panelNode, "cookieRow")[0];
        var cookie = cookieRow.repObject;
        CookieRow.onCopy(cookie);

        var values = CookieClipboard.getFrom();
        fireunit.compare("TestCookie", values.name, "Result from clipboard: name verified.");
        fireunit.compare("TestValue", values.value, "Result from clipboard: value verified.");
        fireunit.compare("4102444800", values.expires, "Result from clipboard: expire date verified.");
        fireunit.compare("/dir", values.path, "Result from clipboard: path verified.");
        fireunit.compare("localhost", values.host, "Result from clipboard: host verified.");
        fireunit.ok(values.isHttpOnly, "Result from clipboard: HTTP Only flag verified.");

        // Finish test
        FBTrace.sysout("fireunit.cookieClipboard.DONE");
        fireunit.testDone();
    });
}, layoutTimeout);
</script>
</head>
<body>
<h1>Test for cookie clipboard.</h1>
</body>
</html>
