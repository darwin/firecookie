<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
          "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<script src="env.js" type="text/javascript"></script>
<script src="utils.js" type="text/javascript"></script>
<script>
enablePrivilege("UniversalXPConnect");

var requestUri = getCurrentPath() + "cookieValues.txt";
fireunit.registerPathHandler(requestUri, function (metadata, response) 
{
    enablePrivilege("UniversalXPConnect");
    FBTrace.sysout("fireunit.cookieValues.server side handler executed.");
    response.setHeader("Set-Cookie", 
        "TestCookie=Test Cookie Value; " +
        "expires=Sat, 01-Jan-2100 00:00:00 GMT; " +
        "path=/dir; " +
        "HttpOnly", 
        false);
});

setTimeout(function() 
{
    enablePrivilege("UniversalXPConnect");
    FBTrace.sysout("fireunit.cookieValues.checkCookieValues.");

    Firebug.showBar(true);
    FirebugChrome.selectPanel("cookies");
    var panelNode = fireunit.panel("cookies");

    makeRequest("GET", requestUri, function(request) 
    {
        enablePrivilege("UniversalXPConnect");

        // Check displayed values.
        var name = FBL.getElementByClass(panelNode, "cookieNameLabel", "cookieLabel");
        fireunit.compare("TestCookie", name.textContent, "Name of the cookie validation");

        var value = FBL.getElementByClass(panelNode, "cookieValueLabel", "cookieLabel");
        fireunit.compare("Test Cookie Value", value.textContent, "Value of the cookie validation");

        var domain = FBL.getElementByClass(panelNode, "cookieDomainLabel", "cookieLabel");
        fireunit.compare("localhost", domain.textContent, "Domain of the cookie validation");

        var size = FBL.getElementByClass(panelNode, "cookieSizeLabel", "cookieLabel");
        fireunit.compare("27 B", size.textContent, "Size of the cookie validation");

        var path = FBL.getElementByClass(panelNode, "cookiePathLabel", "cookieLabel");
        fireunit.compare("/dir", path.textContent, "Path of the cookie validation");

        // xxxHonza: TODO
        //var expires = FBL.getElementByClass(panelNode, "cookieExpiresLabel","cookieLabel");
        //fireunit.compare("...", expires.textContent, "Expire date of the cookie validation");

        var httpOnly = FBL.getElementByClass(panelNode, "cookieHttpOnlyLabel","cookieLabel");
        fireunit.compare("HttpOnly", httpOnly.textContent, "HTTP Only flag validation");

        expandCookieRows(panelNode, "cookieRow");
        var cookieInfo = FBL.getElementsByClass(panelNode, "cookieInfoRow");

        var infoValue = FBL.getElementByClass(panelNode, "cookieInfoValueText", "cookieInfoText");
        fireunit.compare("Test Cookie Value", infoValue.textContent, "Value of the cookie (in the body) validation");

        // Finish test
        FBTrace.sysout("fireunit.cookieValues.DONE");
        fireunit.testDone();
    });
}, layoutTimeout);
</script>
</head>
<body>
<h1>Test for displayed cookie values.</h1>
</body>
</html>
