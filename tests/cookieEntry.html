<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
          "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<script src="env.js" type="text/javascript"></script>
<script src="utils.js" type="text/javascript"></script>
<script>
enablePrivilege("UniversalXPConnect");
    
// Implementation of a request handler (server side).
var requestUri = getCurrentPath() + "cookieEntry.txt";
fireunit.registerPathHandler(requestUri, function (metadata, response) 
{
    enablePrivilege("UniversalXPConnect");
    FBTrace.sysout("fireunit.cookieEntry.server side handler executed.");
    response.setHeader("Set-Cookie", 
        "TestCookie=Test Cookie Value; " + 
        "expires=Sat, 01-Jan-2100 00:00:00 GMT; " +
        "path=/dir;", 
        false);
});

// Check existence of the cookie.
setTimeout(function()
{
    enablePrivilege("UniversalXPConnect");
    FBTrace.sysout("fireunit.cookieEntry.checkCookiePanelEntry.");

    // Show up UI.
    Firebug.showBar(true);
    FirebugChrome.selectPanel("cookies");
    var panelNode = fireunit.panel("cookies");

    // There must be one entry in Cookies panel.
    makeRequest("GET", "cookieEntry.txt", function(request) 
    {
        enablePrivilege("UniversalXPConnect");
        var cookieRow = FBL.getElementsByClass(panelNode, "cookieRow");
        fireunit.compare(1, cookieRow.length, "There must be just one cookie displayed");

        expandCookieRows(panelNode, "cookieRow");

        var cookieInfo = FBL.getElementsByClass(panelNode, "cookieInfoRow");
        fireunit.compare(1, cookieInfo.length, "There must be just one info-body displayed");

        // Finish test
        FBTrace.sysout("fireunit.cookieEntry.DONE");
        fireunit.testDone();
    });
}, layoutTimeout);
</script>
</head>
<body>
<h1>Test for existence of an entry in Cookies panel.</h1>
</body>
</html>
